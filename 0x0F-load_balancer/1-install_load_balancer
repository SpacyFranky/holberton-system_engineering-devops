#!/usr/bin/env bash
# This bash script installs and configures HAproxy on your lb-01 server
# so that is sends traffic to web-01 and web-02.
sudo apt-get -y update
sudo apt-get install -y software-properties-common
sudo add-apt-repository -y ppa:vbernat/haproxy-1.8
sudo apt-get -y update
sudo apt-get install -y haproxy=1.8.\*
FRONTEND="\\\nfrontend 1065-lb-01\\\n\tbind *:80\\\n\tdefault_backend nginx_pool\n"
BACKEND="\\\nbackend nginx_pool\\\n\tbalance roundrobin\\\n\tmode http\\\n\tserver 1065-web-01 3.92.144.7:80 check\\\n\tserver 1065-web-02 18.234.132.216:80 check\n"
sudo sed -i "38i $FRONTEND" /etc/haproxy/haproxy.cfg
sudo sed -i "43i $BACKEND" /etc/haproxy/haproxy.cfg
sudo service haproxy restart
